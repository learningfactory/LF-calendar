<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Calendar OAuth ì—°ë™</title>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/google-calendar@5.11.3/main.global.min.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script> <!-- Google OAuth -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css">
</head>
<body>
    <h2>ğŸ“… ë‚´ ìº˜ë¦°ë”</h2>
    <button id="authorize_button">Google ë¡œê·¸ì¸</button>
    <button id="signout_button" style="display:none;">ë¡œê·¸ì•„ì›ƒ</button>
    <div id="calendar"></div>

    <script>
        let CLIENT_ID = "236715550382-tq8n97cch62bo3jcvuflmij6rj3ab0qp.apps.googleusercontent.com"; // Google Cloudì—ì„œ ë°œê¸‰ë°›ì€ OAuth í´ë¼ì´ì–¸íŠ¸ ID
        let API_KEY = "AIzaSyAUU-C7wQhYfOYaGbm4VdhJ6kKqgeru4MM"; // API í‚¤
        let SCOPES = "https://www.googleapis.com/auth/calendar.readonly"; // ì½ê¸° ê¶Œí•œ

        document.addEventListener('DOMContentLoaded', function() {
            let calendarEl = document.getElementById('calendar');
            let authorizeButton = document.getElementById("authorize_button");
            let signoutButton = document.getElementById("signout_button");

            function handleAuthClick() {
                gapi.auth2.getAuthInstance().signIn();
            }

            function handleSignoutClick() {
                gapi.auth2.getAuthInstance().signOut();
            }

            function initClient() {
                gapi.client.init({
                    apiKey: API_KEY,
                    clientId: CLIENT_ID,
                    discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"],
                    scope: SCOPES
                }).then(() => {
                    gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);
                    updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
                    authorizeButton.onclick = handleAuthClick;
                    signoutButton.onclick = handleSignoutClick;
                });
            }

            function updateSigninStatus(isSignedIn) {
                if (isSignedIn) {
                    authorizeButton.style.display = "none";
                    signoutButton.style.display = "block";
                    loadCalendar();
                } else {
                    authorizeButton.style.display = "block";
                    signoutButton.style.display = "none";
                }
            }

            function loadCalendar() {
                let calendar = new FullCalendar.Calendar(calendarEl, {
                    initialView: 'timeGridWeek',
                    slotMinTime: '09:00:00',
                    slotMaxTime: '18:00:00',
                    events: {
                        googleCalendarId: "primary", // ê¸°ë³¸ ìº˜ë¦°ë” ì‚¬ìš©
                        googleCalendarApiKey: API_KEY
                    }
                });
                calendar.render();
            }

            // âœ… gapi ë¡œë“œ í›„ ì‹¤í–‰ë˜ë„ë¡ ë³€ê²½
            function loadGapi() {
                gapi.load("client:auth2", initClient);
            }
            window.onload = function() {
                if (typeof gapi !== "undefined") {
                    loadGapi();
                } else {
                    console.error("Google API ìŠ¤í¬ë¦½íŠ¸ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
                }
            };
        });
    </script>

    <!-- âœ… gapi ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë§ˆì§€ë§‰ì— ë¡œë“œ -->
    <script async defer src="https://apis.google.com/js/api.js" onload="loadGapi()"></script>
</body>
</html>
